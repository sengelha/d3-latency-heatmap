<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
        font-family: sans-serif;
        font-size: 12px;
    }

    td {
        vertical-align: top;
    }
</style>

<body>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="latency-heatmap.js"></script>

    <h1>Example 1</h1>
    <table>
        <tr>
            <td>
                <h2>400x300</h2>
                <div id="example1-1"></div>
                <script>
                    (function() {
                        var formatTime = d3.time.format("%Y-%m");
                        var chart = d3.latencyHeatmap()
                            .x(function (d) { return formatTime.parse(d.date); })
                            .y(function (d) { return +d.bucket; })
                            .yFormat(function(d) { return d + " s" })
                            .count(function (d) { return +d.count; })
                            .colorRange([d3.rgb('#FFFFFF'), d3.rgb('#5B82A1')])
                            .width(400)
                            .height(300);
            
                        d3.csv("example1.csv", function (data) {
                            var svg = d3.select("#example1-1")
                                .datum(data)
                                .call(chart);
                        });
                    })();
                </script>            
            </td>
            <td>
                <h2>5x5 Rectangles</h2>
                <div id="example1-2"></div>
                <script>
                    (function() {
                        var formatTime = d3.time.format("%Y-%m");
                        var chart = d3.latencyHeatmap()
                            .x(function (d) { return formatTime.parse(d.date); })
                            .y(function (d) { return +d.bucket; })
                            .yFormat(function(d) { return d + " s" })
                            .count(function (d) { return +d.count; })
                            .rectSize([5, 5]);
            
                        d3.csv("example1.csv", function (data) {
                            var svg = d3.select("#example1-2")
                                .datum(data)
                                .call(chart);
                        });
                    })();
                </script>
            </td>
        </tr>
    </table>

    <h1>Example 2</h1>
    <table>
        <tr>
            <td>
                <h2>400x300</h2>
                <div id="example2-1"></div>
                <script>
                    (function() {
                        var nCols = 100;
                        var nRows = 50;
                        var data = [];

                        var dt = new Date(new Date().getTime() - nCols * 1000);
                        for (var i = 0; i < nCols; ++i) {
                            dt = new Date(dt.getTime() + 1000);
                            for (var j = 0; j < nRows; ++j) {
                                data.push({
                                    date: dt,
                                    bucket: j,
                                    count: Math.random()
                                });
                            }
                        }

                        var formatTime = d3.time.format("%Y-%m");
                        var chart = d3.latencyHeatmap()
                            .x(function (d) { return d.date; })
                            .y(function (d) { return d.bucket; })
                            .count(function (d) { return d.count; })
                            .rectSize([10, 10]);

                        setInterval(function() {
                            data = data.slice(nRows);
                            dt = new Date(dt.getTime() + 1000);
                            for (var i = 0; i < nRows; ++i) {
                                data.push({
                                    date: dt,
                                    bucket: i,
                                    count: Math.random()
                                });
                            };
                            var svg = d3.select("#example2-1")
                                .datum(data)
                                .call(chart);
                        }, 1000);
                    })();
                </script>
            </td>
        </tr>
    </table>
</body>

</html>